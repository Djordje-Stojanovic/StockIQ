# Story 1.2: Ticker Input & Validation System

## Status
Draft

## Story
**As a** user,
**I want** to enter any company ticker symbol through a clean web interface,
**so that** I can initiate research analysis for my chosen company.

## Acceptance Criteria
1. Simple HTML form accepts ticker symbol input (e.g., ASML, COST, MSFT)
2. Client-side validation ensures ticker format is appropriate (letters, limited length)
3. FastAPI endpoint validates ticker and returns confirmation or error
4. Basic ticker existence validation (simple format checking for MVP)
5. Error handling for invalid tickers with clear user feedback
6. Session initialization to maintain context throughout assessment process

## Tasks / Subtasks
- [ ] Create ticker input form in frontend (AC: 1)
  - [ ] Add ticker input form to static/index.html
  - [ ] Style form with institutional design matching existing styles.css
  - [ ] Implement form layout with clear labeling and submit button
- [ ] Implement client-side validation (AC: 2)
  - [ ] Add JavaScript validation in static/js/app.js for ticker format
  - [ ] Validate ticker contains only letters (A-Z)
  - [ ] Limit ticker length to 1-6 characters as per standard conventions
  - [ ] Provide real-time feedback on invalid input
- [ ] Create FastAPI ticker validation endpoint (AC: 3)
  - [ ] Create ticker validation route in src/routers/assessment.py
  - [ ] Implement basic ticker format validation logic
  - [ ] Return structured JSON response for validation results
  - [ ] Handle POST requests with ticker data from frontend
- [ ] Implement ticker existence validation (AC: 4)
  - [ ] Add basic format checking for MVP (letters only, proper length)
  - [ ] Create ticker validation utility in src/utils/validators.py
  - [ ] Return appropriate validation status and messages
- [ ] Add comprehensive error handling (AC: 5)
  - [ ] Handle invalid ticker formats with descriptive messages
  - [ ] Implement user-friendly error display in frontend
  - [ ] Add proper HTTP status codes for different error types
  - [ ] Log validation attempts for debugging
- [ ] Implement session initialization (AC: 6)
  - [ ] Create session management in src/services/session_manager.py
  - [ ] Initialize UserSession model when ticker is validated
  - [ ] Store session data for assessment handoff
  - [ ] Generate unique session IDs for tracking

## Dev Notes

### Previous Story Insights
Story 1.1 successfully established:
- Complete FastAPI foundation with health check endpoint
- Project structure with all required directories
- Environment configuration with OpenAI API support
- Testing framework (pytest) properly configured
- Development server ready on Windows 11

### Session Management Models
Based on [Source: architecture/data-models.md#session-management-models]:

**UserSession Model Requirements:**
```python
class UserSession(BaseModel):
    session_id: str = Field(..., description="Unique session identifier")
    ticker_symbol: str = Field(..., description="Company ticker being analyzed")
    user_expertise_level: int = Field(..., ge=1, le=10, description="Calculated expertise (1-10)")
    assessment_responses: List[dict] = Field(default_factory=list)
    report_complexity: str = Field(..., pattern="^(comprehensive|executive)$")
    created_at: datetime = Field(default_factory=datetime.utcnow)
    status: str = Field(default="active", pattern="^(active|research|generation|complete|error)$")
    research_database_path: str = Field(..., description="Path to session research database")
```

### API Specifications
Based on [Source: architecture/api-specification.md#rest-api-specification]:

**Required Endpoint:**
```yaml
/api/assessment/start:
  post:
    summary: Initialize assessment session
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            properties:
              ticker_symbol:
                type: string
                example: "ASML"
    responses:
      '200':
        description: Assessment session created
```

### Frontend Architecture Requirements
Based on [Source: architecture/frontend-architecture.md#component-architecture]:

**Component Organization:**
- Main application logic in `static/js/app.js`
- Utility functions in `static/js/utils.js`
- Institutional styling in `static/css/styles.css`
- Single page application in `static/index.html`

**State Management:**
```typescript
interface AppState {
    currentSession: {
        sessionId: string;
        tickerSymbol: string;
        currentStep: 'ticker' | 'assessment' | 'research' | 'generation' | 'complete';
        expertiseLevel?: number;
        reportComplexity?: 'comprehensive' | 'executive';
    };
}
```

### File Locations
Based on [Source: architecture/unified-project-structure.md]:

**Primary Files to Create/Modify:**
- `static/index.html` - Add ticker input form
- `static/js/app.js` - Client-side validation and form handling
- `static/css/styles.css` - Form styling (institutional design)
- `src/routers/assessment.py` - Ticker validation endpoint
- `src/services/session_manager.py` - Session initialization service
- `src/utils/validators.py` - Ticker validation utilities
- `src/models/assessment.py` - UserSession model implementation

**Router Organization:**
```python
# src/routers/assessment.py should include:
# - POST /api/assessment/start endpoint
# - Ticker validation logic
# - Session initialization
```

### Technology Stack Requirements
Based on [Source: architecture/tech-stack.md]:

**Core Dependencies Already Available:**
- FastAPI 0.104+ for REST API
- Pydantic 2.0+ for data validation (UserSession model)
- JavaScript ES2022 for client-side logic
- Vanilla HTML/CSS/JS for simple interface

**Validation Requirements:**
- Use Pydantic validation for server-side ticker checking
- Client-side JavaScript for real-time validation feedback
- HTTP status codes for error handling

### Coding Standards Requirements
Based on [Source: architecture/coding-standards.md]:

**File Limits:**
- Maximum 500 lines per file
- Functions under 50 lines
- Line length max 100 characters

**Style Requirements:**
- Type hints required for all functions
- Google-style docstrings mandatory
- Use snake_case for variables/functions, PascalCase for classes
- Double quotes for strings

### Project Structure Alignment
No structural conflicts identified. All required directories exist from Story 1.1:
- `src/routers/` for assessment endpoints
- `src/services/` for session management
- `src/models/` for UserSession model
- `src/utils/` for validation utilities
- `static/` for frontend components

### Technical Constraints
- Local Windows 11 development only
- No external ticker validation APIs required for MVP
- Simple format checking sufficient for basic validation
- Session data stored in memory for MVP (no persistence required)

## Testing

**Testing Standards from Architecture:**
Based on [Source: architecture/testing-strategy.md]:

**Test Framework:** pytest (already configured in Story 1.1)
**Test File Location:** tests/ directory with unit/, integration/, e2e/ subdirectories

**Testing Requirements for this story:**
- **Unit Tests:**
  - Test ticker validation logic in `tests/unit/test_validators.py`
  - Test UserSession model in `tests/unit/test_assessment_models.py`
  - Test session manager functionality in `tests/unit/test_session_manager.py`
- **Integration Tests:**
  - Test assessment/start endpoint in `tests/integration/test_assessment_api.py`
  - Test frontend-backend ticker validation flow
- **Frontend Testing:**
  - Validate client-side ticker format checking
  - Test form submission and error display
  - Verify session state management

**Specific Test Cases:**
- Verify valid tickers (ASML, COST, MSFT) are accepted
- Test invalid tickers (numbers, special characters, too long/short) are rejected
- Validate session creation with unique session IDs
- Test error handling for malformed requests
- Verify proper HTTP status codes for validation responses
- Test client-side validation prevents submission of invalid tickers

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-21 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
*This section is populated by the development agent during implementation*

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
*Results from QA Agent QA review of the completed story implementation*